/*! bidbase-dashboard-framework 0.1.4 (2018-08-28) */
angular.module("ui.sortable",[]).value("uiSortableConfig",{}).directive("uiSortable",["uiSortableConfig","$timeout","$log",function(a,b,c){return{require:"?ngModel",link:function(d,e,f,g){function h(a,b){return b&&"function"==typeof b?function(c,d){a(c,d),b(c,d)}:a}var i,j={},k={receive:null,remove:null,start:null,stop:null,update:null};angular.extend(j,a),g?(d.$watch(f.ngModel+".length",function(){b(function(){e.sortable("refresh")})}),k.start=function(a,b){b.item.sortable={index:b.item.index()}},k.activate=function(a,b){i=e.contents();var c=e.sortable("option","placeholder");c&&c.element&&(i=i.not(e.find("."+c.element().attr("class").split(/\s+/).join("."))))},k.update=function(a,b){b.item.sortable.received||(b.item.sortable.dropindex=b.item.index(),e.sortable("cancel")),i.detach().appendTo(e),b.item.sortable.received&&d.$apply(function(){g.$modelValue.splice(b.item.sortable.dropindex,0,b.item.sortable.moved)})},k.stop=function(a,b){!b.item.sortable.received&&"dropindex"in b.item.sortable&&d.$apply(function(){g.$modelValue.splice(b.item.sortable.dropindex,0,g.$modelValue.splice(b.item.sortable.index,1)[0])})},k.receive=function(a,b){b.item.sortable.received=!0},k.remove=function(a,b){d.$apply(function(){b.item.sortable.moved=g.$modelValue.splice(b.item.sortable.index,1)[0]})},d.$watch(f.uiSortable,function(a,b){angular.forEach(a,function(a,b){k[b]&&(a=h(k[b],a)),e.sortable("option",b,a)})},!0),angular.forEach(k,function(a,b){j[b]=h(a,j[b])})):c.info("ui.sortable: ngModel not provided!",e),e.sortable(j)}}}]),angular.module("adf.provider",[]).provider("dashboard",function(){var a={},b={},c='<div class="alert alert-danger">{}</div>',d='      <div class="progress progress-striped active">\n        <div class="progress-bar" role="progressbar" style="width: 100%">\n          <span class="sr-only">loading ...</span>\n        </div>\n      </div>';this.widget=function(b,c){var d=angular.extend({reload:!1},c);if(d.edit){var e={reload:!0};angular.extend(e,d.edit),d.edit=e}return a[b]=d,this},this.structure=function(a,c){return b[a]=c,this},this.messageTemplate=function(a){return c=a,this},this.loadingTemplate=function(a){return d=a,this},this.$get=function(){return{widgets:a,structures:b,messageTemplate:c,loadingTemplate:d}}}),angular.module("adf",["adf.provider","ui.bootstrap","ui.sortable"]),angular.module("adf").directive("adfDashboard",["$rootScope","$log","$modal","dashboard",function(a,b,c,d){function e(a,b){if(a.widgets&&a.widgets.length>0)for(var c=a.widgets.shift();c;)b.widgets.push(c),c=a.widgets.shift()}function f(a,b,c){return angular.forEach(a.rows,function(a){angular.forEach(a.columns,function(a){a.widgets||(a.widgets=[]),b[c]&&(e(b[c],a),c++)})}),c}function g(a){var b=[];return angular.forEach(a.rows,function(a){angular.forEach(a.columns,function(a){b.push(a)})}),b}function h(a,b){var c=g(a);a.rows=b.rows;for(var d=0;d<c.length;)d=f(a,c,d)}function i(a){var b={},c=d.widgets[a].config;return c&&(b=angular.copy(c)),b}return{replace:!0,restrict:"EA",transclude:!1,scope:{structure:"@",name:"@",collapsible:"@",adfModel:"="},controller:["$scope",function(e){e.sortableOptions={connectWith:".droppable-column",handle:".panel-heading-draggable",cursor:"move",items:".widgets",tolerance:"pointer",placeholder:"placeholder",forcePlaceholderSize:!0,opacity:.4};var f=e.name,g=e.adfModel;if(!g||!g.rows){var j=e.structure,k=d.structures[j];k?(g?g.rows=angular.copy(k).rows:g=angular.copy(k),g.structure=j):b.error("could not find structure "+j)}g?(g.title||(g.title=""),e.model=g):b.error("could not find or create model"),e.editMode=!1,e.editClass="",e.toggleEditMode=function(){e.editMode=!e.editMode,""===e.editClass?e.editClass="edit":e.editClass="",e.editMode||a.$broadcast("adfDashboardChanged",f,g)},e.$on("adfDashboardTriggerChange",function(){a.$broadcast("adfDashboardChanged",f,g)}),e.editDashboardDialog=function(){var a=e.$new();a.structures=d.structures;var f=c.open({scope:a,templateUrl:"../src/templates/dashboard-edit.html"});e.changeStructure=function(a,c){b.info("change structure to "+a),h(g,c)},a.closeDialog=function(){f.close(),a.$destroy()}},e.addWidgetDialog=function(a,b){var a=a?a:0,b=b?b:0,f=e.$new();f.widgets=d.widgets;var g={scope:f,templateUrl:"../src/templates/widget-add.html"},h=c.open(g);f.addWidget=function(c){var d={type:c,config:i(c)};f.model.rows[a].columns[b].widgets.push(d),h.close(),f.$destroy()},f.closeDialog=function(){h.close(),f.$destroy()}}}],link:function(a,b,c){a.name=c.name,a.structure=c.structure},templateUrl:"../src/templates/dashboard.html"}}]),angular.module("adf").directive("adfWidgetContent",["$log","$q","$sce","$http","$templateCache","$compile","$controller","$injector","dashboard",function(a,b,c,d,e,f,g,h,i){function j(a){var f=b.defer();if(a.template)f.resolve(a.template);else if(a.templateUrl){var g=c.getTrustedResourceUrl(a.templateUrl);d.get(g,{cache:e}).success(function(a){f.resolve(a)}).error(function(){f.reject("could not load template")})}return f.promise}function k(c,d){var e=c.model,k=c.content;if(c.content){d.html(i.loadingTemplate);var l=c.$new();e.config||(e.config={}),l.config=e.config;var m={$scope:l,widget:e,config:e.config},n={};n.$tpl=j(k),k.resolve&&angular.forEach(k.resolve,function(a,b){angular.isString(a)?n[b]=h.get(a):n[b]=h.invoke(a,a,m)}),b.all(n).then(function(a){angular.extend(a,m);var b=a.$tpl;if(d.html(b),k.controller){var c=g(k.controller,a);d.children().data("$ngControllerController",c)}f(d.contents())(l)},function(b){var c="Could not resolve all promises";b&&(c+=": "+b),a.warn(c),d.html(i.messageTemplate.replace(/{}/g,c))})}}return{replace:!0,restrict:"EA",transclude:!1,scope:{model:"=",content:"="},link:function(a,b,c){k(a,b),a.$on("widgetConfigChanged",function(){k(a,b)}),a.$on("widgetReload",function(){k(a,b)})}}}]),angular.module("adf").directive("adfWidget",["$log","$modal","dashboard",function(a,b,c){function d(b,d,e){var f=b.definition;if(f){var g=c.widgets[f.type];if(g){f.title||(f.title=g.title),b.editMode=e.editMode,b.widget=angular.copy(g);var h=f.config;h?angular.isString(h)&&(h=angular.fromJson(h)):h={},b.config=h,b.isCollapsed=!1}else a.warn("could not find widget "+f.type)}else a.debug("definition not specified, widget was probably removed")}function e(c,d,e){var f=c.definition;f?(c.close=function(){var a=c.col;if(a){var b=a.widgets.indexOf(f);b>=0&&a.widgets.splice(b,1)}d.remove()},c.reload=function(){c.$broadcast("widgetReload")},c.edit=function(){var a=c.$new(),d={scope:a,templateUrl:"../src/templates/widget-edit.html"},e=b.open(d);a.closeDialog=function(){e.close(),a.$destroy();var b=c.widget;b.edit&&b.edit.reload&&c.$broadcast("widgetConfigChanged")}}):a.debug("widget not found")}return{replace:!0,restrict:"EA",transclude:!1,templateUrl:"../src/templates/widget.html",scope:{definition:"=",col:"=column",editMode:"@",collapsible:"="},compile:function(a,b,c){return{pre:d,post:e}}}}]),angular.module("adf").run(["$templateCache",function(a){"use strict";a.put("../src/templates/dashboard-edit.html",'<div class="dashboard-bidbase"><div class="modal-header"><button type="button" class="close" ng-click="closeDialog()" aria-hidden="true">&times;</button><h4 class="modal-title">Edit Dashboard</h4></div><div class="modal-body"><form role="form"><div class="form-group"><label>Structure</label><div class="radio" ng-repeat="(key, structure) in structures"><label><input type="radio" value="{{key}}" ng-model="model.structure" ng-change="changeStructure(key, structure)">{{key}}</label></div></div></form></div><div class="modal-footer"><button type="button" class="btn btn-primary" ng-click="closeDialog()">Close</button></div></div>'),a.put("../src/templates/dashboard.html",'<div class="dashboard-bidbase dashboard-container"><span style="font-size: 16px" class="pull-right"><a href="" ng-if="editMode" title="edit dashboard" ng-click="editDashboardDialog()"><i class="glyphicon glyphicon-cog"></i></a> <a href="" title="{{editMode ? \'Save dashboard\' : \'Edit dashboard\'}}" ng-click="toggleEditMode()"><i class="glyphicon glyphicon-edit" ng-show="!editMode || editMode === \'false\'"></i> <i class="glyphicon glyphicon-floppy-disk" ng-show="editMode === \'true\' || editMode === true"></i></a></span><div class="dashboard" ng-class="editClass"><div ng-repeat="row in model.rows" class="row" ng-class="row.styleClass"><div ng-repeat="col in row.columns" class="column" ng-class="col.styleClass"><div class="droppable-column" ui-sortable="sortableOptions" ng-model="col.widgets"><div class="widgets" ng-repeat="definition in col.widgets"><adf-widget definition="definition" column="col" edit-mode="{{editMode}}" collapsible="collapsible"></div></div><a href="" ng-if="editMode" title="Add new widget" class="addWidgetBtn" ng-click="addWidgetDialog($parent.$parent.$index, $parent.$index)"><i class="glyphicon glyphicon-plus-sign"></i></a></div></div></div></div>'),a.put("../src/templates/widget-add.html",'<div class="dashboard-bidbase"><div class="modal-header"><button type="button" class="close" ng-click="closeDialog()" aria-hidden="true">&times;</button><h4 class="modal-title">Add new widget</h4></div><div class="modal-body"><div style="display: inline-block"><dl class="dl-horizontal"><dt ng-repeat-start="(key, widget) in widgets"><a href="" ng-click="addWidget(key)">{{widget.title}}</a></dt><dd ng-repeat-end="" ng-if="widget.description">{{widget.description}}</dd></dl></div></div><div class="modal-footer"><button type="button" class="btn btn-primary" ng-click="closeDialog()">Close</button></div></div>'),a.put("../src/templates/widget-edit.html",'<div class="dashboard-bidbase"><div class="modal-header"><button type="button" class="close" ng-click="closeDialog()" aria-hidden="true">&times;</button><h4 class="modal-title">{{widget.title}}</h4></div><div class="modal-body"><form role="form"><div class="form-group"><label for="widgetTitle">Title</label><input type="text" class="form-control" id="widgetTitle" ng-model="definition.title" placeholder="Enter title" required></div></form><div ng-if="widget.edit"><adf-widget-content model="definition" content="widget.edit"></div></div><div class="modal-footer"><button type="button" class="btn btn-primary" ng-click="closeDialog()">Close</button></div></div>'),a.put("../src/templates/widget.html",'<div class="dashboard-bidbase widget panel panel-default"><div class="panel-heading" ng-class="{\'panel-heading-draggable\': editMode == \'true\'}"><h3 class="panel-title">{{definition.title}} <span class="pull-right"><a href="" title="reload widget content" ng-if="widget.reload" ng-click="reload()"><i class="glyphicon glyphicon-refresh"></i></a>  <a href="" title="collapse widget" ng-show="collapsible && !isCollapsed" ng-click="isCollapsed = !isCollapsed"><i class="glyphicon glyphicon-minus"></i></a>  <a href="" title="expand widget" ng-show="collapsible && isCollapsed" ng-click="isCollapsed = !isCollapsed"><i class="glyphicon glyphicon-plus"></i></a>  <a href="" title="edit widget configuration" ng-click="edit()" ng-show="editMode === \'true\'"><i class="glyphicon glyphicon-cog"></i></a>  <a href="" title="remove widget" ng-click="close()" ng-show="editMode === \'true\'"><i class="glyphicon glyphicon-remove"></i></a></span></h3></div><div class="panel-body" collapse="isCollapsed"><adf-widget-content model="definition" content="widget"></div></div>')}]);